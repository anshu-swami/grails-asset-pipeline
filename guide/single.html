<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>asset-pipeline 3.2.0</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#releases"><strong>2</strong><span>Release Notes</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#configuration"><strong>3</strong><span>Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#usage"><strong>4</strong><span>Usage</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#extending"><strong>5</strong><span>Extending Asset-Pipeline</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                
            </div>
            <p></p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>asset-pipeline - Reference Documentation</h1>
                            <p><strong>Authors:</strong> </p>
                            <p><strong>Version:</strong> 3.2.0</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#releases"><strong>2</strong><span>Release Notes</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#rel2"><strong>2.1</strong><span>2.0 Release</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#configuration"><strong>3</strong><span>Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#usage"><strong>4</strong><span>Usage</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#directives"><strong>4.1</strong><span>Manifests and Directives</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#organization"><strong>4.2</strong><span>Asset Organization</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#linking"><strong>4.3</strong><span>Linking to Assets</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#encoding"><strong>4.4</strong><span>Encoding</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#extending"><strong>5</strong><span>Extending Asset-Pipeline</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#assetfile"><strong>5.1</strong><span>Asset File Definitions</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#processors"><strong>5.2</strong><span>Processors</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#postprocessors"><strong>5.3</strong><span>Post-Processors</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="introduction">1 Introduction</h1>
The Grails Asset-Pipeline is a plugin used for managing and processing static assets in <a href="http://grails.org" target="blank">Grails</a> applications. Asset-Pipeline functions include processing and minification of both CSS and JavaScript files. It is also capable of being extended to compile custom static assets, such as CoffeeScript or LESS.<p class="paragraph"/>This guide documents the configuration needed to setup the plugin and provides sample code on how to use it.<p class="paragraph"/><h3>Relation to Resources Plugin</h3><p class="paragraph"/>Asset-Pipeline is intended to replace the de facto Grails equivalent <a href="http://grails.org/plugin/resources" target="blank">resources-plugin</a> with a more efficient, developer friendly architecture (similar to <a href="http://guides.rubyonrails.org/asset_pipeline.html" target="blank">Rails Asset Pipeline</a>). The Asset-Pipeline leverages the latest in minification (UglifyJS) to reduce your asset sizes as much as possible. A few differences between the resources plugin and asset-pipeline include:
<ul class="star">
<li>On the fly processing - No more waiting for your assets to reload after making a change</li>
<li>Compiled assets on war create - No more hanging up application boot times while processing files. <code>grails war</code></li>
<li>Reduced Dependence - The plugin has compression, minification, and cache-digests built in.</li>
<li>Easy Debugging - Makes for easy debugging by keeping files seperate in development mode.</li>
<li>Simpler manifests and taglibs - Read on for more information.</li>
</ul><p class="paragraph"/><h3>Additional Information</h3>
<ul class="star">
<li><a href="https://github.com/bertramdev/coffee-grails-asset-pipeline" target="blank">CoffeeScript Asset-Pipeline Plugin</a></li>
<li><a href="https://github.com/bertramdev/less-grails-asset-pipeline" target="blank">LESS CSS Asset-Pipeline Plugin</a></li>
<li><a href="https://github.com/bertramdev/sass-grails-asset-pipeline" target="blank">SASS/SCSS Compass Asset-Pipeline Plugin</a></li>
<li><a href="https://github.com/bertramdev/handlebars-grails-asset-pipeline" target="blank">Handlebars Asset-Pipeline Plugin</a></li>
<li><a href="https://github.com/bertramdev/ember-grails-asset-pipeline" target="blank">Ember Asset-Pipeline Plugin</a></li>
<li><a href="http://guides.rubyonrails.org/asset_pipeline.html" target="blank">Rails Asset Pipeline Guide</a></li>
</ul><p class="paragraph"/>


<h1 id="releases">2 Release Notes</h1>
<h3>Release History</h3>
<ul class="star">
<li>April 22, 2016</li>
<ul class="star">
<li>2.8.0 Release - Bug fixes, New classpath resolver for binary plugin require_tree support. New asset-defer option for javascript taglib.</li>
<li>3.2.0 Release - Exploded plugin support, and jarTaskName support. Bug fixes, New classpath resolver for binary plugin require_tree support. New asset-defer option for javascript taglib.</li>
<li>April 5, 2016</li>
<li>3.1.3 , 2.7.4 Release - Fixes for webjar asset resolution or any binary dependency</li>
<li>March 24, 2016</li>
<li>3.1.2 Release - More aggressive closing of open file handles in Servlet filter for more efficient use of resources</li>
<li>2.7.2 Release - More aggressive closing of open file handles in Servlet filter for more efficient use of resources</li>
<li>March 9, 2016</li>
<li>3.1.1 Release - Improvements to compile time performance,fixed bootstrap bug, reducing open file handles</li>
<li>2.7.2 Release - Improvements to compile time performance, fixed bootstrap bug, and moving of .asscache to target folder</li>
<li>March 4, 2016</li>
<li>2.7.0 Release - Fixes bugs in filter and compiler</li>
<li>3.1.0 Release - 2.7.0 release of core for grails 3.1</li>
</ul>
<li>Nobember 24, 2015</li>
<ul class="star">
<li>2.6.7 Release - Core version bump with fixes for less4j and regex excludes support</li>
<li>3.0.15 (grails3) Release - Core version bump with fixes for less4j and regex excludes support</li>
</ul>
<li>November 16, 2015</li>
<ul class="star">
<li>3.0.14 (grails3) Release - Fixes a bug in SpringClassPath Resolver related to require_tree</li>
<li>2.6.6 Release - Fixes a bug in SpringClassPath resolver related to require_tree</li>
<li>3.0.12 (grails3) Release - Fixes to compile time performance and runtime using stream buffers</li>
<li>2.6.4 Release - Improved compile time performance</li>
</ul>
<li>November 11, 2015</li>
<ul class="star">
<li>3.0.11 (grails3) Release - Fixes to thread safety, and compile static fixes.</li>
</ul>
<li>October 22, 2015</li>
<ul class="star">
<li>3.0.10 (grails3) Release - Cleaned up debug output</li>
<li>3.0.9 (grails3) Release - Asset Compiler is now streaming for binary files. Lower memory usage, faster builds. Production asset serving now caches resources for more speed. Fixed AssetResourceLocator in production mode</li>
</ul>
<li>October 21, 2015</li>
<ul class="star">
<li>2.6.2 Release - less4j dependency updates for less Module</li>
</ul>
<li>October 6, 2015</li>
<ul class="star">
<li>2.5.9 Release - More fixes to AssetResourceLocator</li>
</ul>
<li>October 5, 2015</li>
<ul class="star">
<li>2.5.8 Release - More features for Last Modified date and If-Last-Modified headers. Also core bump with fixes for build phase</li>
</ul>
<li>October 3, 2015</li>
<ul class="star">
<li>2.5.6 Release - Fixing bug in asset filter for cache</li>
<li>2.5.6 Release - Fixing bug in asset filter for cache</li>
<li>2.5.5 Release - Asset Compiler is now streaming for binary files. Lower memory usage, faster builds. Production asset serving now caches resources for more speed. Fixed AssetResourceLocator in production mode</li>
</ul>
<li>October 2, 2015</li>
<ul class="star">
<li>2.5.4 Release - More enhancements to Last Modified headers, also fixes for jar resolution.</li>
</ul>
<li>September 29, 2015</li>
<ul class="star">
<li>2.5.2 Release - Add Last Modified Header as well as fixes to assetPathExists taglib</li>
</ul>
<li>August 21, 2015</li>
<ul class="star">
<li>3.0.8 Release - Added bundle=true attribute option to javascript and stylesheet taglib.</li>
<li>2.5.1 Release - Added bundle=true attribute option to javascript and stylesheet taglib.</li>
</ul>
<li>August 13, 2015</li>
<ul class="star">
<li>2.5.0 Release - Development Runtime cache is now persisted for faster load times! Gradle enhancements for resolvers and deduplicated plugins. Can also now include non digested files in war if needed. Added skipNonDigests config option.</li>
</ul>
<li>July 30, 2015</li>
<ul class="star">
<li>3.0.6 Grails3 Release - Fixes issues with extracted WAR containers</li>
</ul>
<li>July 29, 2015</li>
<ul class="star">
<li>2.4.3 Release - Fixes for gradle plugin portal only</li>
<li>2.4.2 Release - Fixes bug in CSS and HTML Relative URL digest replacement being inaccurate</li>
</ul>
<li>July 28, 2015</li>
<ul class="star">
<li>2.4.0 Release - Fixes bug in asset resolvers being overly aggressive about matching files with wrong extension type.</li>
</ul>
<li>July 2, 2015</li>
<ul class="star">
<li>2.3.9 Release - Fix in _AssetCompile gant script for buildDir, bad quotation used around string</li>
</ul>
<li>June 30, 2015</li>
<ul class="star">
<li>2.3.8 Release - Fixes Jar asset injection for gradle and grails 3.x when assets.compileDir is non standard.</li>
<li>3.0.2 Grails 3 Module - Updated to work with changes to public class directives in core.</li>
</ul>
<li>June 27, 2015</li>
<ul class="star">
<li>2.3.7 Release - Fixes to relative path replacement in css/html. Improvements in Angular @ngInject minification. Support for custom directives on files (i.e. //=wrapped)</li>
</ul>
<li>June 19, 2015</li>
<ul class="star">
<li>2.3.2 Release - Fixes for html processor and performance improvements in css processor</li>
</ul>
<li>June 18, 2015</li>
<ul class="star">
<li>2.3.0 Release - HtmlProcessor can now recalculate relative urls with digests on processing of static html. Fixed issues with classpath file resolution and cache. Better gradle support, boot support, and ratpack support.</li>
</ul>
<li>June 16, 2015</li>
<ul class="star">
<li>2.2.5 Release - Fixing classpath resolution bug with cache.</li>
</ul>
<li>May 31, 2015</li>
<ul class="star">
<li>2.2.3 Release - No longer storing non digest versions in war file, cutting overhead in half. Also removed Commons i/o dependency. Faster byte stream.</li>
</ul>
<li>May 29, 2015</li>
<ul class="star">
<li>2.2.2 Release - Also now scans 'provided' jar dependencies</li>
<li>2.2.1 Release - Fixed issue with binary plugins in war build not including assets</li>
</ul>
<li>March 5, 2015</li>
<ul class="star">
<li>2.1.4 Release - Removed some debug printlns. Whoops!</li>
</ul>
<li>February 25, 2015</li>
<ul class="star">
<li>2.1.3 Release - Fixed bug preventing images / non processable entities from being loaded from binary plugins.</li>
<li>2.1.2 Release - Performance Improvement on scanning classpath for binary plugin assets</li>
</ul>
<li>January 28, 2015</li>
<ul class="star">
<li>2.1.1 Release - Fixed Binary / Classpath Resolver Support. Now scans META-INF/assets, META-INF/static, and META-INF/resources (yes that means webjars).</li>
</ul>
<li>January 5, 2015</li>
<ul class="star">
<li>2.1.0 Release - Fixed bug in CSS Processor breaking asset compile</li>
</ul>
<li>December 31, 2014</li>
<ul class="star">
<li>2.0.21 Release - Nested Grails related asset-pipeline classes into the asset.pipeline.grails package so that the asset.pipeline package does not get marked reloadable</li>
</ul>
<li>December 29, 2014</li>
<ul class="star">
<li>2.0.20 Release - Fixed bug in CSSProcessor and cache digest names, Fixed absolute path issue, documentation improvements, resolver improvements</li>
</ul>
<li>December 10, 2014</li>
<ul class="star">
<li>2.0.17 Release - Fixed bug in CSSProcessor for recalculating relative paths</li>
<li>2.0.16 Release - Fixed bug on 2nd war compile with Windows Platforms</li>
</ul>
<li>December 5, 2014</li>
<ul class="star">
<li>2.0.14 Release - Fixed compileDir for maven based builds</li>
</ul>
<li>December 3, 2014</li>
<ul class="star">
<li>2.0.13 Release - Faster Dev Mode, Fixed bug in war build, Fixed Css Processor with image paths. Fixed files with spaces.</li>
<li>2.0.11 Release - We no longer export groovy,groovy-templates dependency since grails uses groovy-all</li>
<li>2.0.10 Release - Fixed a bug in require_tree directive being a little too grabby. Also fixed windows platform support.</li>
</ul>
<li>December 2, 2014</li>
<ul class="star">
<li>2.0.8 Release - Moved to the new Asset-Pipeline-Core library with 2x faster compiling, binary plugin support, sourcemaps and more.</li>
</ul>
<li>July 29, 2014</li>
<ul class="star">
<li>1.9.6 Release - Whoops I had a typo. Thanks Travis.ci</li>
</ul>
<li>July 29, 2014</li>
<ul class="star">
<li>1.9.5 Release - Fixed Windows Platform Bug in CSS. Upgraded to UglifyJS2.0</li>
</ul>
<li>July 11, 2014</li>
<ul class="star">
<li>1.9.3 Release - Fixed ETag Headers for non-digested files, and updated project docs.</li>
</ul>
<li>July 10, 2014</li>
<ul class="star">
<li>1.9.2 Release - Fixed bug in cache manager, updated docs.</li>
<li>1.9.1 Release - Added commons-io dependency for more recent versions of grails.</li>
</ul>
<li>June 28, 2014</li>
<ul class="star">
<li>1.9.0 Release - Added Absolute Image Support, Various bug fixes. Documentation Improvements.</li>
</ul>
<li>June 6, 2014</li>
<ul class="star">
<li>1.8.11 Release - require_tree directive now falls back to absolute references if path doesn't exist relatively</li>
</ul>
<li>June 1, 2014</li>
<ul class="star">
<li>1.8.10 Release - Added Support for comma delimited require lists</li>
</ul>
<li>April 30, 2014</li>
<ul class="star">
<li>1.8.7 Release - ETag Header Support and Vary: Accept-Encoding</li>
</ul>
<li>April 29, 2014</li>
<ul class="star">
<li>1.8.6 Release - AssetResourceLocator fix</li>
</ul>
<li>April 28, 2014</li>
<ul class="star">
<li>1.8.5 Release - GGTS and STS Eclipse Groovy Compiler Fixes</li>
<li>1.8.4 Release - GGTS and STS Eclipse Groovy Compiler Fixes</li>
</ul>
<li>October 13, 2013</li>
<ul class="star">
<li>1.0.1 release</li>
</ul>
<li>October 28, 2013</li>
<ul class="star">
<li>1.0.2 release</li>
</ul>
<li>November 22, 2013</li>
<ul class="star">
<li>1.1.2 Release</li>
<li>1.1.3 Release</li>
</ul></ul><p class="paragraph"/>


<h2 id="rel2">2.1 2.0 Release</h2>
The new asset-pipeline brings with it a host of new features and improvements. The plugin is no longer restricted to the grails Framework but can be adapted and extended to work with any framework that runs on the JVM. This can provide a more consistent workspace for dealing with many applications on your stack.<p class="paragraph"/><h3>New Features</h3>
<ul class="star">
<li>UglifyJs Replaced by Closure Compiler</li>
<li>Sourcemaps Generated on Minification of Js (Easier debugging in Production)</li>
<li>Custom Asset Resolvers adds support for Binary Grails Plugins</li>
<li>Up to 2x Compiling speed improvements</li>
<li>Transpiling ES6 to ES5 support</li>
<li>Cleaner Extensibility</li>
</ul><p class="paragraph"/><h3>Upgrading to 2.0</h3><p class="paragraph"/>It is important to note that the asset-pipeline plugins that were created before 2.0 will not be immediately compatible. While the updates are minor, third party plugins will have to update to be compatible with 2.0. If possible they should publish gradle builds to maven central so their plugin works with more than just the Grails web stack.<p class="paragraph"/>Another important change is the backwards compatibility. Asset-Pipeline 2.0 is designed to support Grails all the way back to 2.2.0. Anything less than this will more than likely not work correctly. Also the asset-pipeline minimum JVM version has moved up to version 7. This had to be done to facilitate requirements for the new minification library as well as the java nio helpers for file pattern matching.<p class="paragraph"/>Some configuration syntax has changed with relation to minification. Please see the Configuration section of the docs for more information on this. The section on extending the asset-pipeline has also been updated to provide information on how this might be accomplished now. 



<h1 id="configuration">3 Configuration</h1>
Asset-Pipeline has several customizable options to tweak the compiler to suit your needs. Below is a list of the various configuration options and explanations for how to use them<p class="paragraph"/><h3>Excludes and Includes</h3><p class="paragraph"/>Certain files are not needed for compilation in production. This can be configured globally or for a specific plugin by using the provided configuration options:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Value</strong></th></tr><tr class="table-odd"><td>grails.assets.excludes</td><td>&#91;"tiny_mce/src/&#42;.js"]</td></tr><tr class="table-even"><td>grails.assets.plugin."twitter-bootstrap".excludes</td><td>&#91;"&#42;&#42;/&#42;.less"]</td></tr><tr class="table-odd"><td>grails.assets.plugin."twitter-bootstrap".includes</td><td>&#91;"bootstrap.less"]</td></tr></table><p class="paragraph"/>Above you will notice the use of an includes. An includes allows you to override a specific file after the excludes scan has already been performed. The above example makes sure the <code>bootstrap.less</code> file can be compiled from the <code>twitter-bootstrap plugin</code>.<p class="paragraph"/><h3>Minification</h3><p class="paragraph"/>The Asset-pipeline comes with the newer version of Closure Compiler to minify your JavaScript assets. This is great for compression and a few options are provided to tune the minifier. Closure can be enabled/disabled entirely as well as configured via various options.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Value</strong></th><th><strong class="bold">Default</strong></th></tr><tr class="table-odd"><td>grails.assets.minifyJs</td><td><strong class="bold">true</strong> or <strong class="bold">false</strong></td><td><strong class="bold">true</strong></td></tr><tr class="table-even"><td>grails.assets.minifyCss</td><td><strong class="bold">true</strong> or <strong class="bold">false</strong></td><td><strong class="bold">true</strong></td></tr><tr class="table-odd"><td>grails.assets.enableSourceMaps</td><td><strong class="bold">true</strong> or <strong class="bold">false</strong></td><td><strong class="bold">true</strong></td></tr><tr class="table-even"><td>grails.assets.minifyOptions</td><td><strong class="bold">Map</strong></td><td>(see below)</td></tr><tr class="table-odd"><td>grails.assets.skipNonDigests</td><td><strong class="bold">true</strong> or <strong class="bold">false</strong></td><td><strong class="bold">true</strong></td></tr></table><p class="paragraph"/>
<blockquote class="note">
It is normally not necessary to turn off 'skipNonDigests'. Tomcat will automatically still serve files by non digest name and will copy them out using storagePath via the `manifest.properties` alias map.
This simply cuts storage in half. However, if you are attempting to do things like upload to a cdn outside of the cdn-asset-pipeline plugin and via the contents of 'target/assets'. This may still be useful.
</blockquote><p class="paragraph"/><div class="code"><pre>grails.assets.minifyOptions = &#91;
    languageMode: 'ES5',
    targetLanguage: 'ES5', //Can go from ES6 to ES5 <span class="java&#45;keyword">for</span> those bleeding edgers
    optimizationLevel: 'SIMPLE' //Or ADVANCED or WHITESPACE_ONLY
&#93;</pre></div><p class="paragraph"/>Above are the default values for the majority of Closure Compiler. For specifics on what these options do please refer to the documentation for Closure Compiler.<p class="paragraph"/><h3>Mappings and Asset Taglib URLs</h3><p class="paragraph"/>In many cases you may want to change the URL for which to include your static assets. This can be useful when using a CDN or perhaps even using nginx to serve your static assets.<p class="paragraph"/>To change the URL for your taglibs use the following configuration option:<p class="paragraph"/><div class="code"><pre>grails.assets.url = <span class="java&#45;quote">"http://cdn.example.com/"</span></pre></div><p class="paragraph"/>Now your files are gonna reference the CDN when running in the production environment. To go with this feature, you can have your application automatically copy your asset files out of your base WAR file on startup of your application. Optionally the asset URL config can also be defined as a closure that takes a request argument.<p class="paragraph"/><div class="code"><pre>grails.assets.url = &#123; request &#45;&#62;
	<span class="java&#45;keyword">if</span>(request.isSecure()) &#123;
		<span class="java&#45;keyword">return</span> <span class="java&#45;quote">"https://cdn.example.com/"</span>
	&#125; <span class="java&#45;keyword">else</span> &#123;
		<span class="java&#45;keyword">return</span> <span class="java&#45;quote">"http://cdn.example.com/"</span>
	&#125;
&#125;</pre></div><p class="paragraph"/>This allows more fine grained control of your asset URLs based on the incoming request. An example, might be SSL detection or even changing CDN region by source IP.<p class="paragraph"/><div class="code"><pre>grails.assets.storagePath = <span class="java&#45;quote">"/<span class="java&#45;keyword">var</span>/cdn/path"</span></pre></div><p class="paragraph"/>You can also change the default Tomcat path for both debugging and file inclusion using the <code>mapping</code> config option.<p class="paragraph"/><div class="code"><pre>grails.assets.mapping = 'assets'</pre></div><p class="paragraph"/>For all these configuration options, you will want to put these config values in the appropriate environment in Config.groovy.



<h1 id="usage">4 Usage</h1>
Asset-Pipeline automatically creates a series of folders within your <code>grails-app</code> directory:<p class="paragraph"/><div class="code"><pre>grails&#45;app/assets/javascripts
grails&#45;app/assets/images
grails&#45;app/assets/stylesheets</pre></div><p class="paragraph"/>Place your static assets in those directories and simply include them in your layouts.<p class="paragraph"/><h3>Setting up Manifests</h3><p class="paragraph"/>Example <code>grails-app/assets/javascripts/application.js</code>:<p class="paragraph"/><div class="code"><pre>//This is a JavaScript file with its top level require directives
//= require jquery
//= require app/models.js
//= require_tree views
//= require_self<p class="paragraph"/>console.log(<span class="java&#45;quote">"This is my javascript manifest"</span>);</pre></div><p class="paragraph"/>The above is an example of some of the require directives that can be used. Custom directives can be created and overridden into the <code>DirectiveProcessor</code> class.<p class="paragraph"/><blockquote class="note">
These directives can be used across ALL of your files. A dependency graph is built from the recursive require tree and a proper order is determined.
</blockquote><p class="paragraph"/>Optionally, assets can be excluded from processing if included by your require tree. This can dramatically reduce compile time for your assets. To do so, simply leverage the excludes configuration option:<p class="paragraph"/><div class="code"><pre>grails.assets.excludes = &#91;<span class="java&#45;quote">"tiny_mce/src/&#42;.js"</span>&#93;</pre></div><p class="paragraph"/>Or Exclude at the plugin level:<p class="paragraph"/><div class="code"><pre>grails.assets.plugin.<span class="java&#45;quote">"twitter&#45;bootstrap"</span>.excludes = &#91;<span class="java&#45;quote">"&#42;&#42;/&#42;.less"</span>&#93;
grails.assets.plugin.<span class="java&#45;quote">"twitter&#45;bootstrap"</span>.includes = &#91;<span class="java&#45;quote">"bootstrap.less"</span>&#93;</pre></div><p class="paragraph"/>The above will tell asset-pipeline not to precompile less files individually within the twitter-bootstrap plugin, but will compile bootstrap.less.<p class="paragraph"/>It is also possible to exclude files from minification<p class="paragraph"/><div class="code"><pre>grails.assets.minifyOptions.excludes = &#91;<span class="java&#45;quote">"&#42;&#42;/&#42;.min.js"</span>&#93;</pre></div><p class="paragraph"/><h4>Partials</h4><p class="paragraph"/>Another piece of information to know is that files that are prefixed with <code>_</code> Are not compiled individually by the asset-pipeline. These files are considered partials and should be required into another manifest file for compilation.
If, in the event, you need to add these files back to the precompile phase you can define a global includes property like so.<p class="paragraph"/><div class="code"><pre>grails.assets.includes = &#91;<span class="java&#45;quote">"&#42;&#42;/_&#42;.&#42;"</span>&#93;</pre></div><p class="paragraph"/><h3>Including Assets in Views</h3><p class="paragraph"/>Asset pipeline provides several new tag libs for including JavaScript and CSS into your GSP files. For example:<p class="paragraph"/><div class="code"><pre>&#60;head&#62;
    &#60;asset:stylesheet href=<span class="java&#45;quote">"application.css"</span>/&#62;
    &#60;asset:javascript src=<span class="java&#45;quote">"application.js"</span>/&#62;
    &#60;asset:link rel=<span class="java&#45;quote">"shortcut icon"</span> href=<span class="java&#45;quote">"favicon.ico"</span> type=<span class="java&#45;quote">"image/x&#45;icon"</span>/&#62;
&#60;/head&#62;</pre></div><p class="paragraph"/>These helpers will automatically adjust to point to the cache-digested versions of the files when running in a non-development environment.<p class="paragraph"/><blockquote class="note">
In development mode your stylesheets and scripts will be included as individual script tags. This is intended to make it easier for debugging. Bundling is enabled in all other environments and can be forced in development mode by adding <code>grails.assets.bundle=true</code> to your <code>Config.groovy</code> or setting the <code>bundle="true"</code> attribute on the taglib.
</blockquote><p class="paragraph"/><h3>Using with Plugins</h3><p class="paragraph"/>Asset pipeline makes it easy to serve assets from within plugins. It's actually quite simple. The <code>grails-app/assets</code>, and <code>web-app</code> (for legacy plugin support) folders from all plugins are considered include paths. Essentially, when a file is requested (e.g. <code>jquery.js</code>), the Asset-Pipeline first will check the local applications assets folder. If not found there, it will scan through all the installed plugins and serve the requested file. This has the added benefit of allowing you to override a plugins copy of a JavaScript file in your local project.<p class="paragraph"/><h3>Using with Stylesheets</h3><p class="paragraph"/>Asset Pipeline now automatically tries to convert relative URLs specified in your CSS files to absolute paths. This makes it easier to use third party libraries within the Asset-Pipeline stack.<p class="paragraph"/><h3>Precompiling for Production</h3><p class="paragraph"/>Assets are now automatically precompiled into <code>target/assets</code> when you create a war file. This should further simplify the deployment process. During WAR creation, only the changed assets are compiled making your precompiler phase a bit quicker. If, for any reason, you want to ensure a clean assets folder, feel free to run <code>grails asset-clean</code>.<p class="paragraph"/>During WAR build your assets are also minified using Closure Compiler. To disable this feature, you can add the following option to your config:<p class="paragraph"/><div class="code"><pre>grails.assets.minifyJs = <span class="java&#45;keyword">false</span></pre></div><p class="paragraph"/><h3>Serving Assets from External Storage Directory</h3><p class="paragraph"/>Asset Pipeline can be configured to copy your assets files out to an external storage path. This can be useful for setting up your web server (e.g. nginx) to directly serve your static assets. To do so, simply define a config variable in your <code>Config.groovy</code> environment block.<p class="paragraph"/><div class="code"><pre>environments &#123;
    production &#123;
        grails.assets.storagePath = <span class="java&#45;quote">"/full/path/to/storage"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>It is also possible to configure a custom CDN asset URL for serving these assets:<p class="paragraph"/><div class="code"><pre>environments &#123;
    production &#123;
        grails.assets.url = <span class="java&#45;quote">"http://s3.amazonaws.com/asset&#45;pipe/assets/"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Custom Files</h3><p class="paragraph"/>Asset Pipeline uses classes of type <code>AssetFile</code>. By default, this plugin comes with a <code>JsAssetFile</code>, and <code>CssAssetFile</code>. These define the match pattern syntax for understanding requires directives, known extensions, processors, and content-type. The application bases its file look-up on content-type of the request rather than extension. This allows the user to maybe define a <code>CoffeeAssetFile</code> with the JavaScript content type and a request to <code>localhost/assets/app.js</code> would be able to find <code>assets/app.coffee</code>. To add custom file definitions you must add the definition in 2 locations:<p class="paragraph"/>Create a <code>META-INF/asset-pipeline/asset.specs</code> file with the name of your class file (line seperated) to be added to the list of valid implementations. For more information check out the section on extending the asset-pipeline.



<h2 id="directives">4.1 Manifests and Directives</h2>
Asset Pipeline controls asset depdencency by using a custom syntax with commands called "directives". These directives give more fine grained control over what needs included as well as load order.<p class="paragraph"/><h3>Manifest Files</h3><p class="paragraph"/>In the Grails asset pipeline, the concept of a manifest file exists. This is typically the root/parent JavaScript or CSS file which requires all of your application code. This file is then included into your application with a taglib.  Another comparison that can be made here is to the 'Resources Plugin' modules; the difference being, your manifest is kept within the source code of your JavaScript or CSS rather than within a separate file you keep having to jump back to.<p class="paragraph"/>An example JavaScript manifest called 'application.js' might look like this:<p class="paragraph"/><div class="code"><pre>//= require jquery/jquery
//= require_self
//= require_tree .
//= require_full_tree .</pre></div><p class="paragraph"/>Or an example stylesheet syntax may look like this:<p class="paragraph"/><div class="code"><pre>/&#42;
&#42;= require_self
&#42;= require header
&#42;= require navigation
&#42;= require_tree .
&#42;= require_full_tree .
&#42;= encoding UTF&#45;8
&#42;/</pre></div><p class="paragraph"/><h3>Directives</h3><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Directive</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>require</td><td>Includes a single file into the manifest</td></tr><tr class="table-even"><td>require_tree</td><td>Recursively includes all files and subdirectories in the path</td></tr><tr class="table-odd"><td>require_self</td><td>Inserts the body of the current file</td></tr><tr class="table-even"><td>require_full_tree</td><td>Include files from all plugins that contain the relative base path</td></tr><tr class="table-odd"><td>encoding</td><td>Set the processor encoding for this bundle (i.e. UTF-8 or ANSI or Latin1)</td></tr></table><p class="paragraph"/>In JavaScript files, the directive begins with '//='. These directives tell us which files should be injected into this JavaScript file and in what order.<p class="paragraph"/>The <code>require_tree</code> directive will tell asset-pipeline to recursively include all JavaScript in the specified directory. This will include JavaScript sorted in alphabetical order, but the ordering of this type of require should not be relied upon. You can adjust the require order of the <code>require_tree</code> directive by using directives within any sub-JavaScript file. For example, lets say we have a folder called 'models' with a Book and an Author. Let's go further and say we want to ensure the Book model requires author first in a require_tree. This can be done by simply adding "//=require author" at the top of book.js file.<p class="paragraph"/>The <code>require_full_tree</code> directive is an additional directive similar to <code>require_tree</code> except that it will include files from all plugins that contain the relative base path. This is helpful when developing an application that is split into multiple plugins.<p class="paragraph"/>The <code>require_self</code> directive allows you to control where in the manifest the contents of the current file should reside. If the <code>require_self</code> directive is not specified, the contents of the current file are appended to the end of the manifest.<p class="paragraph"/><blockquote class="note">
In the examples above, 2 different directive prefixes were shown, one for CSS, and one for JavaScript. It is important to note that the syntax of these directives can vary based on the file type and preprocessor definition. For example, CoffeeScript files begin with "#=".
</blockquote><p class="paragraph"/><h3>Dynamic Directives</h3><p class="paragraph"/>The asset-pipeline require directives also support the use of the Groovy Templates via the <code>GStringTemplateEngine</code>. This means you can use some conditional require situations based, for example, on the grails Environment.<p class="paragraph"/><div class="code"><pre>//= require $&#123;grails.util.Environment.currentEnvironment.toString() == 'DEVELOPMENT' ? 'ember.debug.js' : 'ember.prod.js'&#125;</pre></div>
or
<div class="code"><pre>//= require $&#123;grails.util.Environment.currentEnvironment == grails.util.Environment.DEVELOPMENT ? 'ember.debug.js' : 'ember.prod.js'&#125;</pre></div><p class="paragraph"/><blockquote class="note">
It is important to note that when prepping for a production release these conditionals are only evaluated in dev runtime and in war build. If you build a war in prod environment but start it up in staging, the evaluation will have already occurred in prod.
</blockquote>



<h2 id="organization">4.2 Asset Organization</h2>
Asset pipeline organization occurs within the "grails-app/assets" folder. This folder can exist within both the main application as well as a plugin.<p class="paragraph"/><blockquote class="note">
A plugin will also include its web-app directory to better deal with plugins that wish to support both the resources plugin as well as asset-pipeline.
</blockquote><p class="paragraph"/><h3>Organization</h3><p class="paragraph"/>Within the "grails-app/assets" directory are several subfolders<p class="paragraph"/><div class="code"><pre>grails&#45;app/assets/javascripts
grails&#45;app/assets/stylesheets
grails&#45;app/assets/images</pre></div><p class="paragraph"/>The first level deep within the assets folder is simply used for organization purposes and can contain folders of any name you wish. File types also don't need to be in any specific folder.
These folders are omitted from the URL mappings and relative path calculations. For example, if I had "grails-app/assets/stylesheets/application.css" and "grails-app/assets/images/logo.png", I would include this in my CSS by the following means:<p class="paragraph"/><div class="code"><pre>&#35;logo &#123;
	background: url('logo.png');
&#125;</pre></div><p class="paragraph"/>You can also directly reference it to better help with support for prebuilt third party CSS libraries like so:<p class="paragraph"/><div class="code"><pre>&#35;logo &#123;
	background: url('../images/logo.png');
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
The above path will automatically be processed and converted to "logo.png" assuming the file exists.
</blockquote><p class="paragraph"/>A common folder that gets added to this set of organization is a "lib" folder. This folder can be useful in organizing third party libraries like jQuery, or Bootstrap.<p class="paragraph"/><h4>Plugins</h4><p class="paragraph"/>Plugins also can have the same "grails-app/assets" folder and their URL mapping is also the same. This means it can be more important to ensure unique naming / path mapping between plugins. This is also powerful in the sense that a plugin can add helper manifests to be used within your apps like jquery, bootstrap, font-awesome, and more.<p class="paragraph"/>These plugins also differ in the fact that the assets within their web-app directory also become available under a similar structure<p class="paragraph"/><div class="code"><pre>web&#45;app/css
web&#45;app/js
web&#45;app/img</pre></div><p class="paragraph"/>These paths also get flattened just like the "grails-app/assets/javascripts" folder does.<p class="paragraph"/>If, in the event, a file within a plugin needs to be overridden within your application, simply create the same file with the same relative path to "grails-app/assets" and it will override / take precedence over the plugin. More on that later.<p class="paragraph"/><blockquote class="note">
Since plugins share the same file structure for assets, as well as web-app. It can become more important to "namespace" your plugins by creating further nested folders. (i.e. the plugin SpudCore puts its application.js file within "grails-app/assets/javascripts/spud/admin/application.js").
</blockquote><p class="paragraph"/><h3>Search Paths</h3><p class="paragraph"/>When a file is referenced via a taglib or a manifest require directive, the asset-pipeline checks for the file in several locations.<p class="paragraph"/>First it tries to find the file relative to the manifest including it. For example "admin/application.js" looking for "table.js"<p class="paragraph"/><div class="code"><pre>// FileName: admin/application.js
//= require table</pre></div><p class="paragraph"/>The first place we will look is within "grails-app/assets/javascripts/admin/<strong class="bold">" We will proceed to do this within all of the asset sub folders across plugins after the main application is searched.<p class="paragraph"/>The next place we will look is the root of all grails-app/assets sub folders (e.g. "grails-app/assets/</strong>/table.js", and "web-app/*/table.js" for plugins).<p class="paragraph"/>In all cases, the applications assets folder takes precedence between the two search paths, but plugins get scanned as well.<p class="paragraph"/><blockquote class="note">
These same conditions should be implemented on any preprocessor extension plugin, e.g. LESS-asset-pipeline follows the same scan for @import directives.
</blockquote>



<h2 id="linking">4.3 Linking to Assets</h2>
Asset Pipeline adds a few new taglibs to properly reference your assets. These taglibs automatically handle swapout of cache digest names during production use as well as any custom URL mapping changes.<p class="paragraph"/><h3>Views</h3><p class="paragraph"/><div class="code"><pre>&#60;head&#62;
  &#60;asset:javascript src=<span class="java&#45;quote">"application.js"</span>/&#62;
  &#60;asset:stylesheet src=<span class="java&#45;quote">"application.css"</span>/&#62;
&#60;/head&#62;</pre></div><p class="paragraph"/>The primary include tags, as shown above, are quite useful for including your relevant JavaScript or stylesheet files. Notice that you do not have to prefix with '/assets', as this is handled automatically by the tag.<p class="paragraph"/>In GSP views, you can also reference images included in the asset-pipeline with the following tag:<p class="paragraph"/><div class="code"><pre>&#60;asset:image src=<span class="java&#45;quote">"logo.png"</span> width=<span class="java&#45;quote">"200"</span> height=<span class="java&#45;quote">"200"</span>/&#62;</pre></div><p class="paragraph"/>Assets can also be referenced within subdirectories if required and simply require the use of the relative path.<p class="paragraph"/><div class="code"><pre>&#60;asset:image src=<span class="java&#45;quote">"icons/delete.png"</span>/&#62;</pre></div><p class="paragraph"/>It is also possible to return an assetPath as a string for injection in your own tags:<p class="paragraph"/><div class="code"><pre>&#60;link href=<span class="java&#45;quote">"$&#123;assetPath(src: 'manifest.json')&#125;"</span>/&#62;</pre></div><p class="paragraph"/>It is also possible to execute a code section only if an asset exists or to simply test for existence<p class="paragraph"/><div class="code"><pre>&#60;asset:assetPathExists src=<span class="java&#45;quote">"test.js"</span>&#62;
This will only be displayed <span class="java&#45;keyword">if</span> the asset exists
&#60;/asset:assetPathExists&#62;</pre></div><p class="paragraph"/>or<p class="paragraph"/><div class="code"><pre>asset.assetPathExists(src: 'test.js') //returns <span class="java&#45;keyword">true</span> or <span class="java&#45;keyword">false</span></pre></div><p class="paragraph"/>
<h3>Getting Resource</h3>
As of version 0.8.2 a new bean exists called <code>assetResourceLocator</code> This can be used to find assets by URI in both development and production mode.<p class="paragraph"/><div class="code"><pre>class ExampleService &#123;
  def assetResourceLocator<p class="paragraph"/>  def someMethod() &#123;
    Resource myResource = assetResourceLocator.findAssetForURI('test.css')
  &#125;
&#125;</pre></div><p class="paragraph"/>
<h3>Deferred Scripts</h3><p class="paragraph"/>Asset-Pipeline provides a set of tags that can be used to ensure script blocks are deferred to the end of your page. This is not recommended as its not very unobtrusive, but has been added to help newcomers upgrade existing apps from resources.<p class="paragraph"/><div class="code"><pre>&#60;asset:javascript src=<span class="java&#45;quote">"application.js"</span> asset&#45;defer/&#62;
&#60;asset:script type=<span class="java&#45;quote">"text/javascript"</span>&#62;
  console.log(<span class="java&#45;quote">"Hello World"</span>);
&#60;/asset:script&#62;
&#60;asset:script type=<span class="java&#45;quote">"text/javascript"</span>&#62;
  console.log(<span class="java&#45;quote">"Hello World 2"</span>);
&#60;/asset:script&#62;</pre></div><p class="paragraph"/>Now to render the output of these scripts simply use the following:<p class="paragraph"/><div class="code"><pre>&#60;asset:deferredScripts/&#62;</pre></div><p class="paragraph"/><h3>Stylesheet References</h3><p class="paragraph"/>Stylesheets commonly make reference to images and in some cases other CSS files using the '@import' directive. With the asset-pipeline in Grails, relative paths can be recalculated and automatically reference the proper file.
For example, if you have a CSS file that looks like this:<p class="paragraph"/><div class="code"><pre>body &#123;
	background: url('/assets/mybg.png') top left repeat&#45;all;
&#125;</pre></div><p class="paragraph"/>The generated output of this css file will be exactly the same:<p class="paragraph"/><div class="code"><pre>body &#123;
	background: url('/assets/mybg.png') top left repeat&#45;all;
&#125;</pre></div><p class="paragraph"/>But, if we use a relative path, the asset-pipeline understands this path and can recalculate a new relative path based on whatever root file may have required the CSS:<p class="paragraph"/><div class="code"><pre>body &#123;
	background: url('mybg.png') top left repeat&#45;all;
&#125;</pre></div><p class="paragraph"/>Would then become:<p class="paragraph"/><div class="code"><pre>body &#123;
	background: url('mybg&#45;a87c78f.png') top left repeat&#45;all;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
In production mode, your image references or CSS references will automatically get their cache-digested name appended to them when using relative paths. More on this later.
</blockquote>



<h2 id="encoding">4.4 Encoding</h2>
In some cases it may be necessary to specify an encoding for your assets. An example might be for Japanese characters in a JavaScript file. To do this, two things must be done. First, we simply set the charset attribute when we include are JavaScript file:<p class="paragraph"/><div class="code"><pre>&#60;asset:javascript src=<span class="java&#45;quote">"application.js"</span> charset=<span class="java&#45;quote">"utf&#45;8"</span>/&#62;</pre></div><p class="paragraph"/>This should take care of testing in development mode and debugging. However, when we move to production/WAR mode the precompiler has no way to infer the desired encoding for compilation. To accomplish this, we have the <code>//= encoding</code> directive. This can be placed at the top of your <code>application.js</code> to define the desired compilation encoding.<p class="paragraph"/><div class="code"><pre>//=encoding UTF&#45;8
//=require_self
//=require_tree .</pre></div><p class="paragraph"/>That's all there is to it.



<h1 id="extending">5 Extending Asset-Pipeline</h1>
The asset-pipeline is extremely extensible and easy to customize to suit one's needs. You might extend the asset-pipeline to handle a new type of asset that may need to be preprocessed before being served to the browser, or you may want to define a new custom directive. This guide will go over the basics of how to perform those tasks with ease.



<h2 id="assetfile">5.1 Asset File Definitions</h2>
The <code>AssetFile</code> definition is where our journey begins. This is the defining file for various file types. Without this definition, the asset-pipeline will treat an unknown file type as a standard passthrough resource. As an example, lets first look at the <code>CssAssetFile</code> definition.<p class="paragraph"/><div class="code"><pre>class CssAssetFile <span class="java&#45;keyword">extends</span> AbstractAssetFile &#123;
  <span class="java&#45;keyword">static</span> <span class="java&#45;keyword">final</span> <span class="java&#45;object">String</span> contentType = 'text/css'
  <span class="java&#45;keyword">static</span> extensions = &#91;'css'&#93;
  <span class="java&#45;keyword">static</span> compiledExtension = 'css'
  <span class="java&#45;keyword">static</span> processors = &#91;CssProcessor&#93;<p class="paragraph"/>  <span class="java&#45;object">String</span> directiveForLine(<span class="java&#45;object">String</span> line) &#123;
    line.find(/&#42;=(.&#42;)/) &#123; fullMatch, directive &#45;&#62; <span class="java&#45;keyword">return</span> directive &#125;
  &#125;
&#125;</pre></div><p class="paragraph"/>This file definition is pretty short but allows us to define some very useful information. First, we look at the static definitions at the top of the class. These static definitions are fairly easy to meta-override with Groovy and add additional processors or adjust with added plugins.<p class="paragraph"/>The <code>contentType</code> property is used to match a file definition with an incoming file request. When the browser requests a <code>text/css</code> content-type file , this file is matched and files matching this definition are scanned. The <code>extensions</code> list tells asset-pipeline which file extensions to scan through and match. In this case it is just 'css', but in the case of LESS for example, we may be looking for extensions <code>less</code>, or <code>css.less</code>.<p class="paragraph"/>The <code>compiledExtension</code> property tells asset-pipelines precompiler what the final file extension should be.<p class="paragraph"/>Finally, the <code>processors</code> array determines the list of processors that need be run on the file contents before returning a result. This array is executed in order. In this case, we have the <code>CssProcessor</code> (a processor for converting the relative image paths and replacing with their cache digested version).<p class="paragraph"/><h4>Directive Definition</h4><p class="paragraph"/>An <code>assetFile</code> can specify a REGEXP pattern for require directives. These directives are used to bundle assets together. Some file types don't utilize these require directives and simply returning a null value will cancel directive processing.<p class="paragraph"/><div class="code"><pre>Pattern directivePattern = ~/(?m)&#42;=(.&#42;)/</pre></div><p class="paragraph"/>NOTE: Used to there was a <code>directiveForLine</code> that matched on each individual line. This was changed to support a multiline regex pattern for faster processing.<p class="paragraph"/>The example above shows a match pattern for CSS files. This allows it to match require directives for the following example:<p class="paragraph"/><div class="code"><pre>/&#42;
&#42;= require_self
&#42;= require_file example_b
&#42;= require_tree .
&#42;/<p class="paragraph"/>body &#123;
  margin&#45;top:25px;
&#125;</pre></div><p class="paragraph"/><h4>Processing Data Streams</h4><p class="paragraph"/>Processors are used to precompile certain assets, and/or adjust the file path contents. The Processor class itself will get a more in depth explanation in the next section. For now, the part we want to look at is the processedStream function.<p class="paragraph"/><div class="code"><pre><span class="java&#45;object">String</span> processedStream(<span class="java&#45;object">Boolean</span> precompiler) &#123;
  def fileText
  def skipCache = precompiler ?: (!processors || processors.size() == 0)<p class="paragraph"/>  <span class="java&#45;keyword">if</span>(baseFile?.encoding || encoding) &#123;
    fileText = file?.getText(baseFile?.encoding ? baseFile.encoding : encoding)
  &#125; <span class="java&#45;keyword">else</span> &#123;
    fileText = file?.text
  &#125;<p class="paragraph"/>  def md5 = AssetHelper.getByteDigest(fileText.bytes)
  <span class="java&#45;keyword">if</span>(!skipCache) &#123;
    def cache = CacheManager.findCache(file.canonicalPath, md5)
    <span class="java&#45;keyword">if</span>(cache) &#123;
      <span class="java&#45;keyword">return</span> cache
    &#125;
  &#125;
  <span class="java&#45;keyword">for</span>(processor in processors) &#123;
    def processInstance = processor.newInstance(precompiler)
    fileText = processInstance.process(fileText, <span class="java&#45;keyword">this</span>)
  &#125;<p class="paragraph"/>  <span class="java&#45;keyword">if</span>(!skipCache) &#123;
    CacheManager.createCache(file.canonicalPath,md5,fileText)
  &#125;<p class="paragraph"/>  <span class="java&#45;keyword">return</span> fileText
&#125;</pre></div><p class="paragraph"/>The example above iterates over all of the processor classes defined in our static <code>processors</code> variable. This creates a new instance and informs the processor whether this is a developer mode request or being issued by the precompiler (useful for determining if file replacements need to be cache digested or not). The <code>processedStream</code> method is now a part of the <code>AbstractAssetFile</code> definition and handles cache management if there are processors.<p class="paragraph"/><h4>Adding the Asset definiton to the list of AssetFiles</h4><p class="paragraph"/>Originally we had to add these classes on startup in both runtime and build phases to the <code>AssetHelper.assetSpecs</code> array. Thanks to contributions by Graeme Rocher we have been able to simplify this process.
Simply adding a list file @META-INF/asset-pipeline/asset.specs to the classpath will automatically get scanned.<p class="paragraph"/>Example:
<div class="code"><pre>asset.pipeline.HtmlAssetFile
asset.pipeline.JsAssetFile
asset.pipeline.CssAssetFile</pre></div><p class="paragraph"/>Another autoscanning file allows us to tack on Processors to already registered AssetFile specifications. This is called the <code>processor.specs</code> file and goes in the same <code>META-INF/asset-pipeline</code> folder.
This is a Properties file with the key being the class path of the Processor and the value being a comma delimited list of <code>AssetFile</code> classes you want the processor added to.<p class="paragraph"/>Example:
<div class="code"><pre>asset.pipeline.CssProcessor=asset.pipeline.CssAssetFile,asset.pipeline.LessAssetFile</pre></div>



<h2 id="processors">5.2 Processors</h2>
Processors are where the real power of asset-pipeline comes into play. These are the driving force behind making compileable assets such as LESS, and CoffeeScript first class citizens. Gone is the need to run a compiler on the side, and gone is the delay between making changes in development.<p class="paragraph"/>A Processor is an implementation of the <code>Processor</code> interface via the <code>AbstractProcessor</code> class. It must have a constructor with an <code>AssetCompiler</code> argument, and it must have a process method. The rest is up to the developer.
The reason the AssetCompiler is passed is for giving the processor access to manipulate the precompiler phase. If a null precompiler is passed, than development mode is assumed and the processor can infer that. An example use case
for this is the SassProcessor in the SASS/SCSS Asset Pipeline Plugin. Image sprite generation causes additional image files to be created that need added to the list of files to process.<p class="paragraph"/><div class="code"><pre>class CoffeeScriptProcessor <span class="java&#45;keyword">extends</span> AbstractProcessor &#123;<p class="paragraph"/>  Scriptable globalScope
  <span class="java&#45;object">ClassLoader</span> classLoader<p class="paragraph"/>  CoffeeScriptProcessor(AssetCompiler precompiler)&#123;
    <span class="java&#45;keyword">super</span>(precompiler)
  &#125;<p class="paragraph"/>  <span class="java&#45;object">String</span> process(<span class="java&#45;object">String</span> input, AssetFile assetFile) &#123;
    <span class="java&#45;keyword">try</span> &#123;
      def cx = Context.enter()
      def compileScope = cx.newObject(globalScope)
      compileScope.setParentScope(globalScope)
      compileScope.put(<span class="java&#45;quote">"coffeeScriptSrc"</span>, compileScope, input)
      def result = cx.evaluateString(compileScope, <span class="java&#45;quote">"CoffeeScript.compile(coffeeScriptSrc)"</span>, <span class="java&#45;quote">"CoffeeScript compile command"</span>, 0, <span class="java&#45;keyword">null</span>)
      <span class="java&#45;keyword">return</span> result
    &#125; <span class="java&#45;keyword">catch</span> (Exception e) &#123;
      <span class="java&#45;keyword">throw</span> <span class="java&#45;keyword">new</span> Exception(<span class="java&#45;quote">""</span><span class="java&#45;quote">"
        CoffeeScript Engine compilation of coffeescript to javascript failed.
        $e
        "</span><span class="java&#45;quote">""</span>)
    &#125; <span class="java&#45;keyword">finally</span> &#123;
      Context.exit()
    &#125;
  &#125;
&#125;</pre></div><p class="paragraph"/>Above is an excerpt of the <code>CoffeeScriptProcessor</code> plugin. This plugin takes advantage of RhinoJS to use the CoffeeScript compiler and provide the application with direct support for CoffeeScript files. The <code>process</code> method takes an input, as well as a reference to the asset file definition, and returns a result. To use your processor simply add it to your 'static processors' array on the <code>AssetFile</code> definition.<p class="paragraph"/>The <code>LESSProcessor</code> was not used in this example as it's more complicated due to supporting the @import LESS directive and cache dependencies on the cache manager. However, it is a great example to look at and highly recommended.



<h2 id="postprocessors">5.3 Post-Processors</h2>
Currently, PostProcessor extensibility is not available. This is currently a feature we are implementing to provide easier dropin for custom minifiers and compressors.


                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Command Line</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/asset-clean.html">asset-clean</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/asset-compile.html">asset-compile</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/asset-precompile.html">asset-precompile</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Spring Beans</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Spring%20Beans/assetResourceLocator.html">assetResourceLocator</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tags</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Tags/assetPath.html">assetPath</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/assetPathExists.html">assetPathExists</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/deferredScripts.html">deferredScripts</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/image.html">image</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/javascript.html">javascript</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/link.html">link</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/script.html">script</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/stylesheet.html">stylesheet</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
